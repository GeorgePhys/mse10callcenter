<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	template="/pages/templates/template.xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:rich="http://richfaces.org/rich">

	<ui:define name="title">Forum</ui:define>
	<ui:define name="head">
	</ui:define>
	<ui:define name="body">
		<h:form>
			<rich:dataGrid value="#{forumAction.thread.posts}" var="post"
				columns="1" width="600px" border="0">
				<f:facet name="header">
					<h:outputText value="#{forumAction.thread.title}" />
					<h:commandLink value="Post" action="#{forumAction.addPost()}"
						rendered="#{loginAction.loggedIn}" />
				</f:facet>
				<rich:panel bodyClass="pbody">
					<f:facet name="header">
						<h:outputText value="#{post.fromUser.fullName}" />
						<h:commandLink value="Add Comment"
							action="#{forumAction.addComment()}"
							rendered="#{loginAction.loggedIn}" />
					</f:facet>
					<h:inputTextarea value="#{post.text}" readonly="#{post.id ne null}" />
					<h:commandButton value="#{labelsBean.getLabel('save')}"
						action="#{forumAction.saveThread()}" rendered="#{post.id eq null}" />
					<h:panelGrid columns="1">
						<rich:list value="#{post.comments}" id="commentId" var="comment"
							type="definitions">
							<f:facet name="term">
								<h:panelGroup layout="block">
									<h:outputText value="#{comment.fromUser.fullName}:"
										style="font-weight:bold" />
								</h:panelGroup>
							</f:facet>
							<h:inputTextarea value="#{comment.text}" />
						</rich:list>
						<h:inputTextarea value="#{forumAction.comment}"
							rendered="#{forumAction.newComment}" />
						<h:commandButton value="#{labelsBean.getLabel('save')}"
							action="#{forumAction.saveComment(post)}"
							rendered="#{forumAction.newComment}" />
					</h:panelGrid>
				</rich:panel>
			</rich:dataGrid>
		</h:form>
	</ui:define>
</ui:composition>
